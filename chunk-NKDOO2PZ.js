import{a as x}from"./chunk-5PQB5SP4.js";import{c as pe,d as ge,e as ve}from"./chunk-DXMZAEM5.js";import{$a as se,B as q,Ba as re,F as Q,Fc as he,Gc as E,Kb as ue,N as X,Pb as de,Q as ee,T as O,Ua as ie,W as te,Za as $,_ as g,ba as p,ca as v,cb as ae,da as f,ea as m,f as J,g as W,hb as oe,i as Y,j as D,jb as le,k as M,o as U,p as T,pa as N,q as Z,uc as fe,v as F,vb as ce,ya as ne}from"./chunk-LSYD42CF.js";import{a as d,b as S,d as G}from"./chunk-2R6CW7ES.js";var H=class{translations;constructor(i){this.translations=i}getTranslation(i){return M(this.translations.get(i)||{})}},Te=new p("");function P(t,i){return t&&(Object.prototype.hasOwnProperty.call(t,i)?t[i]:i.split(".").reduce((e,n)=>e?.[n],t))}function Ee(t,i,e){t=d({},t);let n=i.split("."),r=n.length-1;return n.reduce((s,a,o)=>(o===r?s[a]=e:s[a]=Array.isArray(s[a])?s[a].slice():d({},s[a]),s&&s[a]),t),t}function be(t){return t?Array.isArray(t)?t.length:R(t)?Object.keys(t).length:t?t.length:0:0}function xe(t){return be(t)===0}function Pe(t){return typeof t=="function"}function y(t){return typeof t=="string"}function R(t){return!!t&&typeof t=="object"&&!Array.isArray(t)}function ye(t){return t.replace(/(?:^\w|[A-Z]|\b\w)/g,(i,e)=>e==0?i.toLowerCase():i.toUpperCase()).replace(/\s+|_|-|\//g,"")}function V(t){return t==null}function Le(t){return V(t)===!1}function Ae(t){return t&&typeof t.scope=="string"}function _e(t){return t&&R(t.loader)}function me(t){let i={};function e(n,r){if(n===null)i[r]=null;else if(R(n))for(let[s,a]of Object.entries(n))e(a,r?`${r}.${s}`:s);else i[r]=n}return e(t,""),i}function He(t){let i={};for(let[e,n]of Object.entries(t)){let r=e.split("."),s=i;r.forEach((a,o)=>{o===r.length-1?s[a]=n:(s[a]??={},s=s[a])})}return i}var A=new p("",{providedIn:"root",factory:()=>b}),b={defaultLang:"en",reRenderOnLangChange:!1,prodMode:!1,failedRetries:2,fallbackLang:[],availableLangs:[],missingHandler:{logMissingKey:!0,useFallbackTranslation:!1,allowEmpty:!1},flatten:{aot:!1},interpolation:["{{","}}"],scopes:{keepCasing:!1}};function Ve(t={}){return S(d(d({},b),t),{missingHandler:d(d({},b.missingHandler),t.missingHandler),flatten:d(d({},b.flatten),t.flatten),scopes:d(d({},b.scopes),t.scopes)})}var Se=new p(""),ke=(()=>{class t{config=f(A,{optional:!0})??b;get interpolationMatcher(){return Ke(this.config)}transpile({value:e,params:n={},translation:r,key:s}){if(y(e)){let a,o=e;for(;(a=this.interpolationMatcher.exec(o))!==null;){let[c,l]=a;o=o.replace(c,()=>{let u=l.trim(),h=P(n,u);return Le(h)?h:Le(r[u])?this.transpile({params:n,translation:r,key:s,value:r[u]}):""})}return o}else n&&(R(e)?e=this.handleObject({value:e,params:n,translation:r,key:s}):Array.isArray(e)&&(e=this.handleArray({value:e,params:n,translation:r,key:s})));return e}handleObject({value:e,params:n={},translation:r,key:s}){let a=e;return Object.keys(n).forEach(o=>{let c=this.transpile({value:P(a,o),params:P(n,o),translation:r,key:s});a=Ee(a,o,c)}),a}handleArray(r){var s=r,{value:e}=s,n=G(s,["value"]);return e.map(a=>this.transpile(d({value:a},n)))}static \u0275fac=function(n){return new(n||t)};static \u0275prov=g({token:t,factory:t.\u0275fac})}return t})();function Ke(t){let[i,e]=t.interpolation;return new RegExp(`${i}([^${i}${e}]*?)${e}`,"g")}var Oe=new p(""),ze=(()=>{class t{handle(e,n){if(n.missingHandler.logMissingKey&&!n.prodMode){let r=`Missing translation for '${e}'`;console.warn(`%c ${r}`,"font-size: 12px; color: red")}return e}static \u0275fac=function(n){return new(n||t)};static \u0275prov=g({token:t,factory:t.\u0275fac})}return t})(),Ce=new p(""),Be=(()=>{class t{preSaveTranslation(e){return e}preSaveTranslationKey(e,n){return n}static \u0275fac=function(n){return new(n||t)};static \u0275prov=g({token:t,factory:t.\u0275fac})}return t})(),we=new p(""),Ge=(()=>{class t{userConfig;constructor(e){this.userConfig=e}getNextLangs(){let e=this.userConfig.fallbackLang;if(!e)throw new Error("When using the default fallback, a fallback language must be provided in the config!");return Array.isArray(e)?e:[e]}static \u0275fac=function(n){return new(n||t)(v(A))};static \u0275prov=g({token:t,factory:t.\u0275fac})}return t})();function C(t){if(!t)return"";let i=t.split("/");return i.pop(),i.join("/")}function L(t){return t?t.split("/").pop():""}function k(t,i,e="|"){if(y(t)){let n=t.split(e),r=n.pop();return r===i?[!0,n.toString()]:[!1,r]}return[!1,""]}function Je(t,i){let[e]=k(i,"static");return e?!1:!!t.config.reRenderOnLangChange}function We(t){return t?i=>i:Q(1)}function Ye(t,i){return Object.keys(t).reduce((e,n)=>(e[`${i}/${n}`]=t[n],e),{})}function Me(t,i){return _e(t)?Ye(t.loader,i):void 0}function _(t){return{scope:C(t)||null,langName:L(t)}}function Re(t){let{path:i,inlineLoader:e,mainLoader:n,data:r}=t;if(e){let s=e[i];if(Pe(s)===!1)throw`You're using an inline loader but didn't provide a loader for ${i}`;return e[i]().then(a=>a.default?a.default:a)}return n.getTranslation(i,r)}function Ue({mainLoader:t,path:i,data:e,fallbackPath:n,inlineLoader:r}){return(n?[i,n]:[i]).map(a=>{let o=Re({path:a,mainLoader:t,inlineLoader:r,data:e});return D(o).pipe(T(c=>({translation:c,lang:a})))})}var Ze;var w=(()=>{class t{loader;parser;missingHandler;interceptor;fallbackStrategy;langChanges$;translations=new Map;cache=new Map;firstFallbackLang;defaultLang="";availableLangs=[];isResolvedMissingOnce=!1;lang;failedLangs=new Set;events=new J;events$=this.events.asObservable();config;destroyRef=f(N);constructor(e,n,r,s,a,o){this.loader=e,this.parser=n,this.missingHandler=r,this.interceptor=s,this.fallbackStrategy=o,this.loader||(this.loader=new H(this.translations)),Ze=this,this.config=JSON.parse(JSON.stringify(a)),this.setAvailableLangs(this.config.availableLangs||[]),this.setFallbackLangForMissingTranslation(this.config),this.setDefaultLang(this.config.defaultLang),this.lang=new W(this.getDefaultLang()),this.langChanges$=this.lang.asObservable(),this.events$.subscribe(c=>{c.type==="translationLoadSuccess"&&c.wasFailure&&this.setActiveLang(c.payload.langName)}),this.destroyRef.onDestroy(()=>{this.lang.complete(),this.events.complete(),this.cache.clear()})}getDefaultLang(){return this.defaultLang}setDefaultLang(e){this.defaultLang=e}getActiveLang(){return this.lang.getValue()}setActiveLang(e){return this.parser.onLangChanged?.(e),this.lang.next(e),this.events.next({type:"langChanged",payload:_(e)}),this}setAvailableLangs(e){this.availableLangs=e}getAvailableLangs(){return this.availableLangs}load(e,n={}){let r=this.cache.get(e);if(r)return r;let s,a=this._isLangScoped(e),o;a&&(o=C(e));let c={path:e,mainLoader:this.loader,inlineLoader:n.inlineLoader,data:a?{scope:o}:void 0};if(this.useFallbackTranslation(e)){let u=a?`${o}/${this.firstFallbackLang}`:this.firstFallbackLang,h=Ue(S(d({},c),{fallbackPath:u}));s=F(h)}else{let u=Re(c);s=D(u)}let l=s.pipe(X(this.config.failedRetries),te(u=>{if(Array.isArray(u)){u.forEach(h=>{this.handleSuccess(h.lang,h.translation),h.lang!==e&&this.cache.set(h.lang,M({}))});return}this.handleSuccess(e,u)}),q(u=>(this.config.prodMode||console.error(`Error while trying to load "${e}"`,u),this.handleFailure(e,n))),ee(1),x(this.destroyRef));return this.cache.set(e,l),l}translate(e,n={},r=this.getActiveLang()){if(!e)return e;let{scope:s,resolveLang:a}=this.resolveLangAndScope(r);if(Array.isArray(e))return e.map(l=>this.translate(s?`${s}.${l}`:l,n,a));e=s?`${s}.${e}`:e;let o=this.getTranslation(a),c=o[e];return c?this.parser.transpile({value:c,params:n,translation:o,key:e}):this._handleMissingKey(e,c,n)}selectTranslate(e,n,r,s=!1){let a,o=(l,u)=>this.load(l,u).pipe(T(()=>s?this.translateObject(e,n,l):this.translate(e,n,l)));if(V(r))return this.langChanges$.pipe(O(l=>o(l)));if(r=Array.isArray(r)?r[0]:r,Ae(r)){let l=r;r=l.scope,a=Me(l,l.scope)}if(r=r,this.isLang(r)||this.isScopeWithLang(r))return o(r);let c=r;return this.langChanges$.pipe(O(l=>o(`${c}/${l}`,{inlineLoader:a})))}isScopeWithLang(e){return this.isLang(L(e))}translateObject(e,n={},r=this.getActiveLang()){if(y(e)||Array.isArray(e)){let{resolveLang:a,scope:o}=this.resolveLangAndScope(r);if(Array.isArray(e))return e.map(u=>this.translateObject(o?`${o}.${u}`:u,n,a));let c=this.getTranslation(a);e=o?`${o}.${e}`:e;let l=He(this.getObjectByKey(c,e));return xe(l)?this.translate(e,n,r):this.parser.transpile({value:l,params:n,translation:c,key:e})}let s=[];for(let[a,o]of this.getEntries(e))s.push(this.translateObject(a,o,r));return s}selectTranslateObject(e,n,r){if(y(e)||Array.isArray(e))return this.selectTranslate(e,n,r,!0);let[[s,a],...o]=this.getEntries(e);return this.selectTranslateObject(s,a,r).pipe(T(c=>{let l=[c];for(let[u,h]of o)l.push(this.translateObject(u,h,r));return l}))}getTranslation(e){if(e){if(this.isLang(e))return this.translations.get(e)||{};{let{scope:n,resolveLang:r}=this.resolveLangAndScope(e),s=this.translations.get(r)||{};return this.getObjectByKey(s,n)}}return this.translations}selectTranslation(e){let n=this.langChanges$;if(e){let r=L(e)!==e;this.isLang(e)||r?n=M(e):n=this.langChanges$.pipe(T(s=>`${e}/${s}`))}return n.pipe(O(r=>this.load(r).pipe(T(()=>this.getTranslation(r)))))}setTranslation(e,n=this.getActiveLang(),r={}){let a=d(d({},{merge:!0,emitChange:!0}),r),o=C(n),c=e;if(o){let Ne=this.getMappedScope(o);c=me({[Ne]:e})}let l=o?L(n):n,u=d(d({},a.merge&&this.getTranslation(l)),c),h=this.config.flatten.aot?u:me(u),Fe=this.interceptor.preSaveTranslation(h,l);this.translations.set(l,Fe),a.emitChange&&this.setActiveLang(this.getActiveLang())}setTranslationKey(e,n,r={}){let s=r.lang||this.getActiveLang(),a=this.interceptor.preSaveTranslationKey(e,n,s),o={[e]:a};this.setTranslation(o,s,S(d({},r),{merge:!0}))}setFallbackLangForMissingTranslation({fallbackLang:e}){let n=Array.isArray(e)?e[0]:e;e&&this.useFallbackTranslation(n)&&(this.firstFallbackLang=n)}_handleMissingKey(e,n,r){if(this.config.missingHandler.allowEmpty&&n==="")return"";if(!this.isResolvedMissingOnce&&this.useFallbackTranslation()){this.isResolvedMissingOnce=!0;let s=this.translate(e,r,this.firstFallbackLang);return this.isResolvedMissingOnce=!1,s}return this.missingHandler.handle(e,this.getMissingHandlerData(),r)}_isLangScoped(e){return this.getAvailableLangsIds().indexOf(e)===-1}isLang(e){return this.getAvailableLangsIds().indexOf(e)!==-1}_loadDependencies(e,n){let r=L(e);return this._isLangScoped(e)&&!this.isLoadedTranslation(r)?Z([this.load(r),this.load(e,{inlineLoader:n})]):this.load(e,{inlineLoader:n})}_completeScopeWithLang(e){return this._isLangScoped(e)&&!this.isLang(L(e))?`${e}/${this.getActiveLang()}`:e}_setScopeAlias(e,n){this.config.scopeMapping||(this.config.scopeMapping={}),this.config.scopeMapping[e]=n}isLoadedTranslation(e){return be(this.getTranslation(e))}getAvailableLangsIds(){let e=this.getAvailableLangs()[0];return y(e)?this.getAvailableLangs():this.getAvailableLangs().map(n=>n.id)}getMissingHandlerData(){return S(d({},this.config),{activeLang:this.getActiveLang(),availableLangs:this.availableLangs,defaultLang:this.defaultLang})}useFallbackTranslation(e){return this.config.missingHandler.useFallbackTranslation&&e!==this.firstFallbackLang}handleSuccess(e,n){this.setTranslation(n,e,{emitChange:!1}),this.events.next({wasFailure:!!this.failedLangs.size,type:"translationLoadSuccess",payload:_(e)}),this.failedLangs.forEach(r=>this.cache.delete(r)),this.failedLangs.clear()}handleFailure(e,n){V(n.failedCounter)&&(n.failedCounter=0,n.fallbackLangs||(n.fallbackLangs=this.fallbackStrategy.getNextLangs(e)));let r=e.split("/"),a=n.fallbackLangs[n.failedCounter];if(this.failedLangs.add(e),this.cache.has(a))return this.handleSuccess(a,this.getTranslation(a)),Y;let o=a===r[r.length-1];if(!a||o){let l="Unable to load translation and all the fallback languages";throw r.length>1&&(l+=", did you misspelled the scope name?"),new Error(l)}let c=a;return r.length>1&&(r[r.length-1]=a,c=r.join("/")),n.failedCounter++,this.events.next({type:"translationLoadFailure",payload:_(e)}),this.load(c,n)}getMappedScope(e){let{scopeMapping:n={},scopes:r={keepCasing:!1}}=this.config;return n[e]||(r.keepCasing?e:ye(e))}resolveLangAndScope(e){let n=e,r;if(this._isLangScoped(e)){let s=L(e),a=this.isLang(s);n=a?s:this.getActiveLang(),r=this.getMappedScope(a?C(e):e)}return{scope:r,resolveLang:n}}getObjectByKey(e,n){let r={},s=`${n}.`;for(let a in e)a.startsWith(s)&&(r[a.replace(s,"")]=e[a]);return r}getEntries(e){return e instanceof Map?e.entries():Object.entries(e)}static \u0275fac=function(n){return new(n||t)(v(Te,8),v(Se),v(Oe),v(Ce),v(A),v(we))};static \u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),qe=(()=>{class t{html;static \u0275fac=function(n){return new(n||t)};static \u0275cmp=oe({type:t,selectors:[["ng-component"]],inputs:{html:"html"},decls:1,vars:1,consts:[[1,"transloco-loader-template",3,"innerHTML"]],template:function(n,r){n&1&&ue(0,"div",0),n&2&&de("innerHTML",r.html,ie)},encapsulation:2})}return t})(),K=class{view;vcr;constructor(i,e){this.view=i,this.vcr=e}attachView(){if(this.view instanceof $)this.vcr.createEmbeddedView(this.view);else if(y(this.view)){let i=this.vcr.createComponent(qe);i.instance.html=this.view,i.hostView.detectChanges()}else this.vcr.createComponent(this.view)}detachView(){this.vcr.clear()}},Qe=new p(""),Xe=new p(""),Ie=new p(""),z=class{initialized=!1;resolve({inline:i,provider:e,active:n}){let r=n;if(this.initialized)return r=n,r;if(e){let[,s]=k(e,"static");r=s}if(i){let[,s]=k(i,"static");r=s}return this.initialized=!0,r}resolveLangBasedOnScope(i){return C(i)?L(i):i}resolveLangPath(i,e){return e?`${e}/${i}`:i}},B=class{service;constructor(i){this.service=i}resolve(i){let{inline:e,provider:n}=i;if(e)return e;if(n){if(Ae(n)){let{scope:r,alias:s=this.service.config.scopes.keepCasing?r:ye(r)}=n;return this.service._setScopeAlias(r,s),r}return n}}},jt=(()=>{class t{destroyRef=f(N);service=f(w);tpl=f($,{optional:!0});providerLang=f(Qe,{optional:!0});providerScope=f(Ie,{optional:!0});providedLoadingTpl=f(Xe,{optional:!0});cdr=f(E);host=f(re);vcr=f(ae);renderer=f(se);view;memo=new Map;key;params={};inlineScope;inlineRead;prefix;inlineLang;inlineTpl;currentLang;loaderTplHandler;initialized=!1;path;langResolver=new z;scopeResolver=new B(this.service);strategy=this.tpl===null?"attribute":"structural";static ngTemplateContextGuard(e,n){return!0}ngOnInit(){let e=Je(this.service,this.providerLang||this.inlineLang);if(this.service.langChanges$.pipe(O(n=>{let r=this.langResolver.resolve({inline:this.inlineLang,provider:this.providerLang,active:n});return Array.isArray(this.providerScope)?F(this.providerScope.map(s=>this.resolveScope(r,s))):this.resolveScope(r,this.providerScope)}),We(e),x(this.destroyRef)).subscribe(()=>{this.currentLang=this.langResolver.resolveLangBasedOnScope(this.path),this.strategy==="attribute"?this.attributeStrategy():this.structuralStrategy(this.currentLang,this.prefix||this.inlineRead),this.cdr.markForCheck(),this.initialized=!0}),!this.initialized){let n=this.resolveLoadingContent();n&&(this.loaderTplHandler=new K(n,this.vcr),this.loaderTplHandler.attachView())}}ngOnChanges(e){this.strategy==="attribute"&&Object.keys(e).some(r=>!e[r].firstChange)&&this.attributeStrategy()}attributeStrategy(){this.detachLoader(),this.renderer.setProperty(this.host.nativeElement,"innerText",this.service.translate(this.key,this.params,this.currentLang))}structuralStrategy(e,n){this.memo.clear();let r=this.getTranslateFn(e,n);this.view?(this.view.context.$implicit=r,this.view.context.currentLang=this.currentLang):(this.detachLoader(),this.view=this.vcr.createEmbeddedView(this.tpl,{$implicit:r,currentLang:this.currentLang}))}getTranslateFn(e,n){return(r,s)=>{let a=n?`${n}.${r}`:r,o=s?`${a}${JSON.stringify(s)}`:a;return this.memo.has(o)||this.memo.set(o,this.service.translate(a,s,e)),this.memo.get(o)}}resolveLoadingContent(){return this.inlineTpl||this.providedLoadingTpl}ngOnDestroy(){this.memo.clear()}detachLoader(){this.loaderTplHandler?.detachView()}resolveScope(e,n){let r=this.scopeResolver.resolve({inline:this.inlineScope,provider:n});this.path=this.langResolver.resolveLangPath(e,r);let s=Me(n,r);return this.service._loadDependencies(this.path,s)}static \u0275fac=function(n){return new(n||t)};static \u0275dir=le({type:t,selectors:[["","transloco",""]],inputs:{key:[0,"transloco","key"],params:[0,"translocoParams","params"],inlineScope:[0,"translocoScope","inlineScope"],inlineRead:[0,"translocoRead","inlineRead"],prefix:[0,"translocoPrefix","prefix"],inlineLang:[0,"translocoLang","inlineLang"],inlineTpl:[0,"translocoLoadingTpl","inlineTpl"]},features:[ne]})}return t})();function je(t){let i=[nt(ke),it(ze),st(Be),rt(Ge)];return t.config&&i.push(et(t.config)),t.loader&&i.push(tt(t.loader)),i}function et(t){return m([{provide:A,useValue:Ve(t)}])}function tt(t){return m([{provide:Te,useClass:t}])}function Dt(...t){return t.map(i=>({provide:Ie,useValue:i,multi:!0}))}function nt(t){return m([{provide:Se,useClass:t,deps:[A]}])}function rt(t){return m([{provide:we,useClass:t,deps:[A]}])}function it(t){return m([{provide:Oe,useClass:t}])}function st(t){return m([{provide:Ce,useClass:t}])}var Ft=new p("TRANSLOCO_TEST_LANGS - Available testing languages"),Nt=new p("TRANSLOCO_TEST_OPTIONS - Testing options");var I=[{id:"en",label:"English"},{id:"fa",label:"\u0641\u0627\u0631\u0633\u06CC"}];var _t=(t,i="i18n")=>I.reduce((e,n)=>(e[n.id]=()=>t(n.id,i),e),{});var De=(t,i)=>{let e=f(w),n=t.clone();return n=t.clone({headers:t.headers.set("Accept-Language",e.getActiveLang())}),i(n)};var j=class t{_httpClient=f(pe);getTranslation(i){return this._httpClient.get(`./assets/i18n/${i}.json`)}static \u0275fac=function(e){return new(e||t)};static \u0275prov=g({token:t,factory:t.\u0275fac,providedIn:"root"})};var sn=()=>[ge(ve([De])),je({config:{availableLangs:I,prodMode:!he()},loader:j}),ce(()=>(()=>{let i=f(fe).slice(0,2),e=f(w);return e.setDefaultLang(i),e.setActiveLang(i),()=>U(e.load(i))})()())];export{w as a,jt as b,Dt as c,I as d,_t as e,sn as f};
