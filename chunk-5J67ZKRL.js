import{b as Be,c as Ne,d as Ve,e as Oe,f as Pe,g as je,h as xt,i as He,j as ze,k as Ge,l as qe,m as Ue,n as We,o as Ye,p as Je,q as Ke}from"./chunk-3AMPKEMF.js";import{a as Qe}from"./chunk-BWGT66AB.js";import{c as $e}from"./chunk-E5HG5JXR.js";import{b as Re,c as Ct}from"./chunk-XI2ZTVHH.js";import{fa as U,g as Ee,ga as Fe}from"./chunk-ZEFBM2DM.js";import{a as Me,b as Ie,d as be,i as Te}from"./chunk-F666NW2W.js";import{a as Le}from"./chunk-MZ5OU527.js";import{a as de,b as H,c as ue,d as _e,f as we}from"./chunk-QMGWJ3SU.js";import"./chunk-NZI65ZIX.js";import{b as re,c as et,d as it,e as se}from"./chunk-QUE6WEEE.js";import{a as fe,b as st}from"./chunk-NVWDB3DN.js";import{c as ke}from"./chunk-A6LKAHRK.js";import{a as tt}from"./chunk-SM3FRAAW.js";import{a as gt}from"./chunk-A2EUKBD6.js";import{a as vt,b as Ae,c as De}from"./chunk-5B4W75AM.js";import{A as ft,B as ht,a as he,b as ve,c as ge,g as Ce,h as ct,i as xe,j as lt,l as R,n as mt,o as pt,p as Se,r as wt,t as dt,u as ut,w as _t,z as ye}from"./chunk-WBWVCJJF.js";import"./chunk-2YGBMOOR.js";import"./chunk-RSA34F7K.js";import{k as at}from"./chunk-AKZVIXXJ.js";import"./chunk-T3ITTJXM.js";import{Y as nt,Z as ot,aa as ce,fa as le,ga as me,ha as pe,ia as rt,ka as P,la as j}from"./chunk-DMPZODJ5.js";import"./chunk-2NU47HXX.js";import{b as ae}from"./chunk-FTPCJKRQ.js";import{j as Tt,m as X,o as ne,p as Z,r as oe}from"./chunk-35W3654S.js";import{$ as k,$b as Yt,A as Pt,Ba as Ut,Bc as It,Cc as Xt,Dc as Zt,E as L,Eb as f,Ec as T,Ia as B,Ic as C,Ja as Y,Jc as S,Kc as bt,Lc as q,M as jt,Nb as _,Nc as K,Oc as te,Tb as y,Tc as ee,Ub as Et,Vb as V,Wb as O,Xb as s,Xc as ie,Y as Ht,Yb as r,Zb as v,_b as Wt,ac as Jt,ba as zt,bc as J,ca as Gt,g as Bt,h as Nt,hc as I,ia as p,ib as o,j as G,jc as u,m as Vt,nb as Qt,q as x,qb as M,rb as kt,rc as Mt,sc as Kt,ta as Q,tc as b,ua as W,uc as c,vc as d,w as Ot,wc as g,xb as A,za as qt,zb as N}from"./chunk-FXLTEG45.js";import{a as z,b as Dt,c as $t}from"./chunk-2R6CW7ES.js";var Xe=(()=>{class e{static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=A({type:e,selectors:[["main-accounts"]],decls:1,vars:0,template:function(i,n){i&1&&v(0,"router-outlet")},dependencies:[et],encapsulation:2,changeDetection:0})}}return e})();var St="code",yt="asc",E=class{constructor(a){this.id=a.id,this.code=a.code,this.accountTypeId=a.accountTypeId,this.accountTypeName=a.accountTypeName,this.createDate=new Date(a.createDate),this.closeDate=a.closeDate?new Date(a.closeDate):void 0,this.balance=a.balance,this.persons=a.persons?.map(t=>new Ft(t)),this.note=a.note,this.isActive=a.isActive}get fullName(){return this.accountTypeName+" "+this.persons.map(a=>a.name).join("/")}},Ft=class{constructor(a){this.id=a.id,this.code=a.code,this.name=a.name}};var $=(()=>{class e{constructor(){this._appConfig=p(Le),this._httpClient=p(ae),this._accounts=new Bt(Ve)}get accounts$(){return this._accounts.asObservable()}getAccounts(t=1,i=10,n=`${St} ${yt}`){return this._httpClient.get(`${this._appConfig.apiEndpoint}/api/account/all`,{params:{page:t,pageSize:i,sortBy:n}}).pipe(x(l=>new Ne(Dt(z({},l),{items:l.items.map(m=>new E(m))}))),k(l=>this._accounts.next(l)))}getLookupAccounts(){return this._httpClient.get(`${this._appConfig.apiEndpoint}/api/account/lookup`).pipe(x(t=>t))}getLookupAccountTypes(){return this._httpClient.get(`${this._appConfig.apiEndpoint}/api/accountType/lookup`).pipe(x(t=>t))}getAccount(t){return this._httpClient.get(`${this._appConfig.apiEndpoint}/api/account/${t}`).pipe(x(i=>new E(i)))}getBalanceAccount(t){return this._httpClient.get(`${this._appConfig.apiEndpoint}/api/account/${t}/balance`).pipe(x(i=>i))}getAccountWithBalance(t){return Ot([this.getAccount(t),this.getBalanceAccount(t)]).pipe(x(i=>new E(z(z({},i[0]),i[1]))))}createAccount(t){return this._httpClient.post(`${this._appConfig.apiEndpoint}/api/account`,t).pipe(x(i=>new E(i)))}updateAccount(t){return this._httpClient.put(`${this._appConfig.apiEndpoint}/api/account`,t).pipe(x(i=>new E(i)),k(i=>{if(this._accounts.value){let n=this._accounts.value.items.findIndex(l=>l.id===i.id)??0;this._accounts.value.items[n]=i,this._accounts.next(this._accounts.value)}}))}closeAccount(t){return this._httpClient.post(`${this._appConfig.apiEndpoint}/api/account/close`,t).pipe(x(i=>new E(Dt(z({},i),{balance:0}))),k(i=>{if(this._accounts.value){let n=this._accounts.value.items.findIndex(l=>l.id===i.id)??0;this._accounts.value.items[n]=i,this._accounts.next(this._accounts.value)}}))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275prov=Gt({token:e,factory:e.\u0275fac,providedIn:"root"})}}return e})();var ai=e=>[e];function ri(e,a){if(e&1&&(Wt(0),s(1,"mat-icon",1),c(2),r(),Yt()),e&2){let t=a.$implicit,i=u();o(),_("ngClass",T(3,ai,i.value()?"text-green-400":"text-red-400"))("matTooltip",i.value()?t("active"):t("inactive")),o(),g(" ",i.value()?"check_circle":"cancel"," ")}}var ti=(()=>{class e{constructor(){this.value=B(!0,{transform:ee})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=A({type:e,selectors:[["main-accounts-status"]],inputs:{value:[1,"value"]},decls:1,vars:0,consts:[[4,"transloco"],[1,"text-green-400",3,"ngClass","matTooltip"]],template:function(i,n){i&1&&f(0,ri,3,5,"ng-container",0)},dependencies:[X,j,P,st,fe,H],styles:[`main-accounts-status{display:flex}
`],encapsulation:2,changeDetection:0})}}return e})();var mi=(e,a)=>a.id,pi=()=>["card","new"],di=e=>({"mat-mdc-extended-fab-collapses":e}),ui=e=>["card","view",e];function _i(e,a){if(e&1&&(s(0,"div",11)(1,"form",12)(2,"div",13)(3,"mat-icon"),c(4,"search"),r(),v(5,"input",14),r()()()),e&2){let t=a.$implicit,i=u();o(),_("formGroup",i.filterForm),o(4),_("placeholder",t("accounts.search"))}}function fi(e,a){if(e&1&&(s(0,"div",4)(1,"div",15),v(2,"msk-avatar",16),r(),s(3,"div",17)(4,"div",18),c(5),r(),s(6,"div",19)(7,"span"),c(8),r()()(),s(9,"div",20),v(10,"main-accounts-status",21),r()()),e&2){let t=a.$implicit;_("routerLink",T(5,ui,t.id)),o(2),_("name",t.persons[0].name),o(3),g(" ",t.fullName," "),o(3),g("#",t.code,""),o(2),_("value",t.isActive)}}function hi(e,a){if(e&1&&(s(0,"div",5),c(1),r()),e&2){let t=a.$implicit;o(),g(" ",t("accounts.empty-list")," ")}}function vi(e,a){e&1&&f(0,hi,2,1,"div",22)}function gi(e,a){if(e&1&&(s(0,"span"),c(1),r()),e&2){let t=a.$implicit;o(),d(t("new"))}}var At=(()=>{class e{constructor(){this._destroyRef=p(Ut),this._accountService=p($),this._gridContent=kt.required(at),this._paginator=kt.required(U),this._sort=new Pe,this.isLoading=M(!1),this.isFabCollapses=M(!1),this.lastOffsetScroll=0,this.pageSizeOptions=Be,this.filterForm=new Se({search:new wt(""),isActive:new wt(null)})}ngOnInit(){this.accounts$=this._accountService.accounts$}ngAfterViewInit(){this._sort&&this._paginator&&(this._sort.sort({id:St,start:yt,disableClear:!0}),this._sort.sortChange.pipe(tt(this._destroyRef),k(()=>this._paginator().pageIndex=0)).subscribe(),Pt(this._sort.sortChange,this._paginator().page).pipe(tt(this._destroyRef),Ht(()=>this.getAccounts())).subscribe()),this._gridContent().elementScrolled().pipe(tt(this._destroyRef),x(t=>t.target.scrollTop||0),k(t=>{let i=t>10?this.lastOffsetScroll<t:!1;this.isFabCollapses()!==i&&this.isFabCollapses.set(i),this.lastOffsetScroll=t})).subscribe()}getAccounts(t=!1){return this.isLoading.set(!0),this._accountService.getAccounts(t?1:this._paginator().pageIndex+1,this._paginator().pageSize,`${this._sort.active} ${this._sort.direction}`).pipe(L(i=>G),jt(()=>{this.isLoading.set(!1)}))}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=A({type:e,selectors:[["main-accounts-list"]],viewQuery:function(i,n){i&1&&(Mt(n._gridContent,at,5),Mt(n._paginator,U,5)),i&2&&Kt(2)},decls:19,vars:21,consts:[[1,"page-layout","grid-scroll"],["class","header",4,"transloco"],[1,"content"],["cdkScrollable","",1,"content-grid"],["matRipple","",1,"content-grid-item","tow-line",3,"routerLink"],[1,"text-secondary","p-8","text-center","text-xl","font-semibold","tracking-tight","sm:p-16"],[1,"content-fab-container"],["mat-fab","","extended","",3,"routerLink","ngClass"],[4,"transloco"],[1,"content-paginator",3,"length","pageIndex","pageSize","pageSizeOptions","showFirstLastButtons","disabled"],[1,"pointer-events-none","invisible","absolute","h-0","w-0","opacity-0"],[1,"header"],[1,"flex","w-full","items-center",3,"formGroup"],[1,"msk-mat-search-bar","w-full"],["formControlName","search","autocomplete","off",3,"placeholder"],[1,"content-grid-item-avatar"],[3,"name"],[1,"content-grid-item-content"],[1,"truncate"],[1,"flex","items-center","gap-2","truncate"],[1,"content-grid-item-end"],[3,"value"],["class","text-secondary p-8 text-center text-xl font-semibold tracking-tight sm:p-16",4,"transloco"]],template:function(i,n){if(i&1&&(s(0,"div",0),f(1,_i,6,2,"div",1),s(2,"div",2)(3,"div",3),V(4,fi,11,7,"div",4,mi,!1,vi,1,0,"div",5),C(7,"async"),r(),s(8,"div",6)(9,"button",7)(10,"mat-icon"),c(11,"add"),r(),f(12,gi,2,1,"span",8),r()(),v(13,"mat-paginator",9),C(14,"async"),C(15,"async"),C(16,"async"),r()(),s(17,"div",10),v(18,"router-outlet"),r()),i&2){let l,m,h,D;o(4),O((l=S(7,10,n.accounts$))==null?null:l.items),o(5),_("routerLink",Zt(18,pi))("ngClass",T(19,di,n.isFabCollapses()))("@zoomIn",void 0),o(4),_("length",(m=S(14,12,n.accounts$))==null?null:m.total)("pageIndex",(h=S(15,14,n.accounts$))==null?null:h.pageIndex)("pageSize",(D=S(16,16,n.accounts$))==null?null:D.pageSize)("pageSizeOptions",n.pageSizeOptions)("showFirstLastButtons",!0)("disabled",n.isLoading())}},dependencies:[Z,X,ft,dt,lt,mt,pt,ht,ut,_t,se,et,at,j,P,Ee,Ct,ot,nt,rt,me,ct,je,Fe,U,H,xt,ti],encapsulation:2,data:{animation:gt},changeDetection:0})}}return e})();var ei=(()=>{class e{constructor(){this._elementRef=p(Y),this._localeId=p(K)}onInput(t){let i=this._elementRef.nativeElement.value.replace(/[^\d.-]/g,"");if(this.onChange){let n=parseFloat(i);this.onChange(isNaN(n)?"":n)}this._formatInputValue()}onBlur(t){this.onTouched&&this.onTouched(),this._formatInputValue()}writeValue(t){if(t){let i=Tt(t,this._localeId,"","","1.0-2");this._elementRef.nativeElement.value=i}else this._elementRef.nativeElement.value=""}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._elementRef.nativeElement.disabled=t}_formatInputValue(){let t=this._elementRef.nativeElement.value.replace(/[^\d.-]/g,"");if(t){let i=parseFloat(t);if(!isNaN(i)){let n=Tt(i,this._localeId,"","","1.0-2");this._elementRef.nativeElement.value=n}}else this._elementRef.nativeElement.value=""}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=N({type:e,selectors:[["input","mskCurrencyMask",""],["textarea","mskCurrencyMask",""]],hostBindings:function(i,n){i&1&&I("input",function(m){return n.onInput(m)})("blur",function(m){return n.onBlur(m)})},exportAs:["mskCurrencyMask"],features:[Xt([{provide:xe,useExisting:zt(()=>e),multi:!0}])]})}}return e})();var ii=(()=>{class e{constructor(){this._elementRef=p(Y),this._localeId=p(K),this._currencyCode=p(te)}ngOnInit(){let t=Intl.NumberFormat(this._localeId,{style:"currency",currency:this._currencyCode}).formatToParts().find(i=>i.type==="currency")?.value||this._currencyCode;this._elementRef.nativeElement.innerHTML=t}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=N({type:e,selectors:[["","mskCurrencySymbol",""]],exportAs:["mskCurrencySymbol"]})}}return e})();var ni=(()=>{class e{constructor(){this._renderer=p(Qt),this._matSelect=p(vt),this.searchList=B([]),this.searchItems=B.required(),this.searchPlaceholder=B("search ..."),this.filteredList=new Nt(1),ie(()=>{this._list=this.searchList(),this.filteredList.next(this._list?this._list.slice():[])})}get showSearch(){return this._list&&this._list.length>5}onOpenedChange(t){if(!this.showSearch)return;if(!t){this.filteredList.next(this._list.slice());return}this._initMultipleHandling();let i=this._renderer.createElement("input");this._renderer.setAttribute(i,"placeholder",this.searchPlaceholder()),this._renderer.addClass(i,"mdc-text-field__input"),this._renderer.listen(i,"input",()=>{let m=i.value?i.value.toLowerCase():"";this.filteredList.next(this._list.filter(h=>this.searchItems()==null?this._includes(h,m):typeof this.searchItems()=="string"?this._includes(h[this.searchItems()],m):Array.isArray(this.searchItems())?this.searchItems().some(D=>this._includes(h[D],m)):!0)),setTimeout(()=>this._matSelect._keyManager.setFirstItemActive(),0)});let n=this._renderer.createElement("mat-option");this._renderer.setAttribute(n,"role","option"),this._renderer.addClass(n,"mat-mdc-option"),this._renderer.addClass(n,"mdc-list-item"),this._renderer.addClass(n,"z-999"),this._renderer.addClass(n,"top-0"),this._renderer.addClass(n,"sticky"),this._renderer.addClass(n,"border-b"),this._renderer.setStyle(n,"background","inherit"),this._renderer.appendChild(n,i);let l=document.querySelector(".mat-mdc-select-panel");if(!l)throw new Error("Cannot find mat select panel");this._renderer.setStyle(l,"padding-top","0"),this._renderer.insertBefore(l,n,l.firstChild),i.focus()}_includes(t,i){return t.toString().toLowerCase().includes(i)}_initMultipleHandling(){this._previousSelectedValues=this._matSelect.value,this._matSelect.valueChange?.subscribe(t=>{let i=!1,n=t&&Array.isArray(t)?[...t]:[];if(this._matSelect.multiple&&this._previousSelectedValues&&Array.isArray(this._previousSelectedValues)){(!t||!Array.isArray(t))&&(t=[]);let l=this._matSelect.options.map(m=>m.value);this._previousSelectedValues.forEach(m=>{!n.some(h=>this._matSelect.compareWith(h,m))&&!l.some(h=>this._matSelect.compareWith(h,m))&&(n.push(m),i=!0)})}this._previousSelectedValues=n,i&&this._matSelect._onChange(n)})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275dir=N({type:e,selectors:[["","mskSelectSearch",""]],hostBindings:function(i,n){i&1&&I("openedChange",function(m){return n.onOpenedChange(m)})},inputs:{searchList:[1,"searchList"],searchItems:[1,"searchItems"],searchPlaceholder:[1,"searchPlaceholder"]},exportAs:["mskSelectSearch"]})}}return e})();var Ci=(e,a)=>a.id,xi=e=>({code:e}),Si=e=>({t:e});function yi(e,a){if(e&1){let t=J();s(0,"button",11),I("click",function(){Q(t);let n=u(3);return W(n.editMode())}),s(1,"mat-icon",12),c(2,"edit"),r()()}}function Ai(e,a){if(e&1&&f(0,yi,3,0,"button",10),e&2){let t,i=u(2);y((t=i.data.item())!=null&&t.isActive?0:-1)}}function Di(e,a){if(e&1&&(s(0,"span"),c(1),r()),e&2){let t=a.$implicit,i=u(3);o(),d(i.form.enabled?t("save"):"")}}function ki(e,a){if(e&1){let t=J();s(0,"button",13),I("click",function(){Q(t);let n=u(2);return W(n.saveAndClose())}),f(1,Di,2,1,"span",14),r()}if(e&2){let t=u(2);_("disabled",t.form.disabled)("mskSpinner",t.form.disabled)}}function Ei(e,a){if(e&1&&(s(0,"msk-dialog",8),Jt(1,9),f(2,Ai,1,1,"ng-template",null,2,q)(4,ki,2,2,"ng-template",null,3,q),r()),e&2){let t,i=a.$implicit,n=b(3),l=b(5),m=u(),h=b(2),D=b(4);_("title",i(m.data.action(),T(6,xi,(t=m.data.item())==null?null:t.code)))("hasAction",m.data.action()!=="view")("primaryAction",l)("trailing",n),o(),_("ngTemplateOutlet",m.data.action()==="view"?h:D)("ngTemplateOutletContext",T(8,Si,i))}}function Mi(e,a){if(e&1&&(s(0,"div",24)(1,"button",25)(2,"mat-icon",26),c(3,"arrow_upward"),r(),c(4),r(),s(5,"button",27)(6,"mat-icon",26),c(7,"arrow_downward"),r(),c(8),r(),s(9,"button",27)(10,"mat-icon",26),c(11,"swap_horiz"),r(),c(12),r()()),e&2){let t=a.$implicit;o(4),g(" ",t("deposit")," "),o(4),g(" ",t("withdraw")," "),o(4),g(" ",t("transfer")," ")}}function Ii(e,a){if(e&1&&(s(0,"div",19)(1,"span",20),c(2),r(),s(3,"span",21),c(4),C(5,"number"),v(6,"small",22),r()(),f(7,Mi,13,3,"div",23)),e&2){let t,i=u().t,n=u();o(2),d(i("credit")),o(2),g(" ",S(5,2,(t=n.data.item())==null?null:t.balance)," ")}}function bi(e,a){if(e&1&&(s(0,"div",17)(1,"div",28),v(2,"msk-avatar",29),r(),s(3,"div",30)(4,"span"),c(5),r(),s(6,"span"),c(7),r()(),s(8,"div",28)(9,"mat-icon",31),c(10,"open_in_new"),r()()()),e&2){let t=a.$implicit;o(2),_("name",t.name),o(3),d(t.name),o(2),g("#",t.code,"")}}function Ti(e,a){if(e&1&&(s(0,"div",18)(1,"div",28)(2,"mat-icon"),c(3,"credit_card_gear"),r()(),s(4,"div",30)(5,"span"),c(6),r(),s(7,"span"),c(8),r()()()),e&2){let t,i=u().t,n=u();o(6),d((t=n.data.item())==null?null:t.accountTypeName),o(2),d(i("accountType"))}}function wi(e,a){if(e&1&&(s(0,"div",18)(1,"div",28)(2,"mat-icon"),c(3,"calendar_add_on"),r()(),s(4,"div",30)(5,"span"),c(6),C(7,"mskDateTime"),r(),s(8,"span"),c(9),r()()()),e&2){let t,i=u().t,n=u();o(6),d(bt(7,2,(t=n.data.item())==null?null:t.createDate,"longDate")||"-"),o(3),d(i("createDate"))}}function Fi(e,a){if(e&1&&(s(0,"div",18)(1,"div",28)(2,"mat-icon"),c(3,"event_busy"),r()(),s(4,"div",30)(5,"span"),c(6),C(7,"mskDateTime"),r(),s(8,"span"),c(9),r()()()),e&2){let t,i=u().t,n=u();o(6),d(bt(7,2,(t=n.data.item())==null?null:t.closeDate,"longDate")||"-"),o(3),d(i("closeDate"))}}function Li(e,a){if(e&1&&(s(0,"div",15)(1,"div",16),c(2),r(),s(3,"div",18)(4,"div",28)(5,"mat-icon"),c(6,"sticky_note_2"),r()(),s(7,"div",30)(8,"span"),c(9),r()()()()),e&2){let t,i=u().t,n=u();o(2),d(i("note")),o(7),d((t=n.data.item())==null?null:t.note)}}function Ri(e,a){if(e&1){let t=J();s(0,"div",34)(1,"div",16),c(2),r(),s(3,"div",35),I("click",function(){Q(t);let n=u(3);return W(n.updateStatus())}),s(4,"div",28)(5,"mat-icon",36),c(6," cancel "),r()(),s(7,"div",30)(8,"span",36),c(9),r()()()()}if(e&2){let t=a.$implicit;o(2),d(t("settings")),o(7),g(" ",t("accounts.deactivate")," ")}}function $i(e,a){e&1&&(v(0,"div",32),f(1,Ri,10,2,"div",33))}function Bi(e,a){if(e&1&&(f(0,Ii,8,4),s(1,"div",15)(2,"div",16),c(3),r(),V(4,bi,11,3,"div",17,Ci),r(),s(6,"div",15)(7,"div",16),c(8),r(),f(9,Ti,9,2,"div",18)(10,wi,10,5,"div",18)(11,Fi,10,5,"div",18),r(),f(12,Li,10,2,"div",15)(13,$i,2,0)),e&2){let t,i,n,l,m,h,D,Rt=a.t,F=u();y((t=F.data.item())!=null&&t.isActive?0:-1),o(3),d(Rt("owners")),o(),O((i=F.data.item())==null?null:i.persons),o(4),d(Rt("about")),o(),y((n=F.data.item())!=null&&n.accountTypeName?9:-1),o(),y((l=F.data.item())!=null&&l.createDate?10:-1),o(),y((m=F.data.item())!=null&&m.closeDate?11:-1),o(),y((h=F.data.item())!=null&&h.note?12:-1),o(),y((D=F.data.item())!=null&&D.isActive?13:-1)}}function Ni(e,a){if(e&1&&(s(0,"msk-alert",38)(1,"span",45),c(2),r(),c(3),r()),e&2){let t=a.$implicit;o(2),d(t("info-edit-title")),o(),g(" ",t("info-edit-description")," ")}}function Vi(e,a){e&1&&f(0,Ni,4,2,"msk-alert",44),e&2&&_("translocoRead","accounts")}function Oi(e,a){if(e&1&&(s(0,"msk-alert",39),c(1),r()),e&2){let t=u(2);_("@shake",void 0),o(),g(" ",t.alert().message," ")}}function Pi(e,a){if(e&1&&(s(0,"mat-option",42),c(1),r()),e&2){let t=a.$implicit;_("value",t.id),o(),d(t.name)}}function ji(e,a){if(e&1&&(s(0,"div",40)(1,"mat-form-field")(2,"mat-label"),c(3),r(),It(4),C(5,"async"),s(6,"mat-select",46,5),C(8,"transloco"),V(9,Pi,2,2,"mat-option",42,Et),C(11,"async"),r(),s(12,"mat-error"),c(13),r()(),s(14,"mat-form-field")(15,"mat-label"),c(16),r(),v(17,"input",47)(18,"mat-datepicker-toggle",48)(19,"mat-datepicker",null,6),s(21,"mat-error"),c(22),r()()()),e&2){let t=b(7),i=b(20),n=u().t,l=u();o(3),d(n("accountType"));let m=S(5,9,l.accountTypeList$);o(3),_("searchList",m)("searchItems","name")("searchPlaceholder",S(8,11,"search")),o(3),O(S(11,13,t.filteredList)),o(4),d(l.formErrors.accountTypeId),o(3),d(n("createDate")),o(),_("matDatepicker",i),o(),_("for",i),o(4),d(l.formErrors.createDate)}}function Hi(e,a){if(e&1&&(s(0,"mat-option",42),c(1),r()),e&2){let t=a.$implicit;_("value",t.id),o(),d(t.name)}}function zi(e,a){if(e&1&&(s(0,"mat-form-field")(1,"mat-label"),c(2),r(),v(3,"input",49)(4,"span",50),s(5,"mat-error"),c(6),r()()),e&2){let t=u().t,i=u();o(2),d(t("initCredit")),o(4),d(i.formErrors.initCredit)}}function Gi(e,a){if(e&1&&(s(0,"form",37),f(1,Vi,1,1,"msk-alert",38)(2,Oi,2,2,"msk-alert",39)(3,ji,23,15,"div",40),s(4,"mat-form-field")(5,"mat-label"),c(6),r(),It(7),C(8,"async"),s(9,"mat-select",41,4),C(11,"transloco"),s(12,"mat-select-trigger"),c(13),r(),V(14,Hi,2,2,"mat-option",42,Et),C(16,"async"),r(),s(17,"mat-error"),c(18),r()(),f(19,zi,7,2,"mat-form-field"),s(20,"mat-form-field"),v(21,"textarea",43),s(22,"mat-error"),c(23),r()()()),e&2){let t=a.t,i=b(10),n=u();_("formGroup",n.form),o(),y(n.data.action()==="edit"?1:-1),o(),y(n.alert().show?2:-1),o(),y(n.data.action()==="new"?3:-1),o(3),d(t("owners"));let l=S(8,14,n.personList$);o(3),_("searchList",l)("searchItems","name")("searchPlaceholder",S(11,16,"search")),o(4),d(n.personIdTitles(l)),o(),O(S(16,18,i.filteredList)),o(4),d(n.formErrors.personId),o(),y(n.data.action()==="new"?19:-1),o(2),_("placeholder",t("note"))("rows",2),o(2),d(n.formErrors.note)}}var oi=(()=>{class e{constructor(){this.data=p(Ie),this.dialogRef=p(Me),this._formBuilder=p(ye),this._peopleService=p(Oe),this._accountService=p($),this._translocoService=p(de),this._mskConfirmationService=p(Qe),this.formErrors={},this.personList$=this._peopleService.getLookupPersons(),this.accountTypeList$=this._accountService.getLookupAccountTypes(),this.alert=M({show:!1,message:""})}ngOnInit(){this.form=this._formBuilder.group({id:[0,R.required],personId:[[],R.required],accountTypeId:["",R.required],initCredit:["",[R.required,R.min(1e3)]],createDate:[new Date(new Date().setHours(0,0,0,0)),R.required],note:""}),new Ye(this.form,this.formErrors,this._translocoService),this.form.patchValue(this.data.item()||{}),this.form.get("personId")?.patchValue(this.data.item()?.persons.map(t=>t.id)||[])}personIdTitles(t){let i=this.form.get("personId")?.value;return t?.find(l=>l.id===i[0])?.name+(i.length>1?` (+${i.length-1} ${this._translocoService.translate("other")})`:"")}editMode(){this.data.action.set("edit"),this.form.get("initCredit")?.clearValidators()}updateStatus(){let t=this.data.item()?.isActive;this._mskConfirmationService.open({title:this._translocoService.translate(t?"accounts.deactivate":"accounts.activate"),message:this._translocoService.translate(t?"accounts.deactivate-message":"accounts.activate-message",{name:this.data.item()?.fullName}),actions:{confirm:{label:this._translocoService.translate(t?"close":"open")},cancel:{label:this._translocoService.translate("cancel")}}}).afterClosed().subscribe(n=>{if(n!=="confirmed")return;let l={id:this.data.item()?.id,closeDate:new Date(new Date().setMinutes(new Date().getMinutes()-1,0,0))};this._accountService.closeAccount(l).pipe(x(m=>{this.data.item.set(m)}),L(m=>G)).subscribe()})}saveAndClose(){if(Ke(this.form),this.form.invalid)return;this.form.disable(),this.alert.set({show:!1,message:""}),(this.data.action()==="edit"?this._accountService.updateAccount({id:this.form.value.id,personId:this.form.value.personId,note:this.form.value.note}):this._accountService.createAccount(this.form.value)).pipe(k(i=>this.dialogRef.close(i)),L(i=>(this.form.enable(),this.alert.set({show:!0,message:i.error.message}),i.error.errors&&Je(i.error.errors,this.form),G))).subscribe()}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=A({type:e,selectors:[["main-people-details"]],decls:5,vars:1,consts:[["viewTemplate",""],["formTemplate",""],["trailing",""],["primaryAction",""],["searchPersons","mskSelectSearch"],["searchAccountTypes","mskSelectSearch"],["picker",""],[3,"title","hasAction","primaryAction","trailing",4,"transloco","translocoRead"],[3,"title","hasAction","primaryAction","trailing"],["msk-dialog-content","",3,"ngTemplateOutlet","ngTemplateOutletContext"],["mat-icon-button",""],["mat-icon-button","",3,"click"],[1,"mat-icon-rtl-mirror","text-current"],["mat-button","",3,"click","disabled","mskSpinner"],[4,"transloco"],[1,"msk-mat-card-filled","mb-2","p-4"],[1,"text-secondary","mb-2","font-bold"],["matRipple","",1,"msk-list-item","-mx-4","cursor-pointer"],[1,"msk-list-item","-mx-4"],[1,"flex","flex-col","gap-4","p-4"],[1,"text-on-surface-variant","text-label-medium"],[1,"text-on-surface","text-title-large"],["mskCurrencySymbol",""],["class","grid grid-cols-3 gap-4 py-4",4,"transloco"],[1,"grid","grid-cols-3","gap-4","py-4"],["mat-flat-button",""],[1,"hidden","sm:block"],["mat-stroked-button",""],[1,"msk-list-item-icon"],[3,"name"],[1,"msk-list-item-content"],[1,"mat-icon-rtl-mirror"],[1,"my-4","border-t"],["class","mb-2",4,"transloco"],[1,"mb-2"],["matRipple","",1,"msk-list-item","-mx-6","cursor-pointer","gap-2",3,"click"],[1,"!text-error"],[1,"flex","flex-auto","flex-col","gap-y-2",3,"formGroup"],["appearance","outline","type","info","dismissible","",1,"mb-4"],["appearance","outline","type","error",1,"mb-4"],[1,"flex","flex-col","gap-x-4","sm:flex-row","[&>*]:flex-1"],["formControlName","personId","multiple","","mskSelectSearch","",3,"searchList","searchItems","searchPlaceholder"],[3,"value"],["matInput","","formControlName","note",3,"placeholder","rows"],["class","mb-4","appearance","outline","type","info","dismissible","",4,"transloco","translocoRead"],["mskAlertTitle",""],["formControlName","accountTypeId","mskSelectSearch","",3,"searchList","searchItems","searchPlaceholder"],["matInput","","formControlName","createDate",3,"matDatepicker"],["matIconSuffix","",3,"for"],["matInput","","formControlName","initCredit","mskCurrencyMask","","autocomplete","off"],["matTextSuffix","","mskCurrencySymbol",""]],template:function(i,n){i&1&&f(0,Ei,6,10,"msk-dialog",7)(1,Bi,14,8,"ng-template",null,0,q)(3,Gi,24,20,"ng-template",null,1,q),i&2&&_("translocoRead","accounts.details")},dependencies:[ne,Z,oe,ft,dt,lt,mt,pt,ht,ut,_t,j,P,Ct,Re,Ce,he,ve,ge,ot,nt,rt,le,pe,De,vt,Ae,ce,st,ct,qe,He,ze,Ge,Te,ue,H,ke,xt,Ue,$e,ei,ii,ni,We],encapsulation:2,data:{animation:gt},changeDetection:0})}}return e})();var Lt=(()=>{class e{constructor(){this._router=p(it),this._injector=p(qt),this._matDialog=p(be),this._activatedRoute=p(re)}ngOnInit(){let t=this._activatedRoute.snapshot.url[1].path;this._matDialog.open(oi,{autoFocus:t!=="view",disableClose:t!=="view",data:{action:M(t),item:M(this._activatedRoute.snapshot.data.card)}}).afterClosed().subscribe(i=>{t==="new"&&i!="cancelled"&&this._injector.get(At).getAccounts().subscribe(),this._router.navigate([this._activatedRoute.snapshot.url.map(()=>"../").join("")],{relativeTo:this._activatedRoute})})}static{this.\u0275fac=function(i){return new(i||e)}}static{this.\u0275cmp=A({type:e,selectors:[["main-accounts-card"]],decls:0,vars:0,template:function(i,n){},encapsulation:2,changeDetection:0})}}return e})();var qi=$t({"./i18n/en.json":()=>import("./chunk-V4WTMKZN.js"),"./i18n/fa.json":()=>import("./chunk-HTZE5BF4.js")});var Ui=(e,a)=>{let t=p($),i=p(it);return t.getAccountWithBalance(e.paramMap.get("id")??0).pipe(L(n=>{console.error(n);let l=a.url.split("/").slice(0,-1).join("/");return i.navigateByUrl(l),Vt(()=>new Error(n.message))}))},da=[{path:"",component:Xe,providers:[_e({scope:"accounts",loader:we((e,a)=>qi(`./${a}/${e}.json`))})],children:[{path:"",component:At,resolve:{persons:()=>p($).getAccounts()},children:[{path:"card/new",component:Lt,resolve:{}},{path:"card/view/:id",component:Lt,resolve:{card:Ui}}]}]}];export{Xe as AccountsComponent,da as routes};
