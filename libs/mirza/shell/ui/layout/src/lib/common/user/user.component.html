<!-- Button -->
<button matIconButton [matMenuTriggerFor]="userActions">
  <span class="relative size-6">
    <msk-avatar [name]="currentStore()?.name ?? ''" size="small"></msk-avatar>
  </span>
</button>
<!-- Menu -->
<mat-menu [xPosition]="'before'" #userActions="matMenu" class="mz-user-panel-profile">
  <div
    class="sticky z-10 flex h-14 items-center justify-between px-2 transition"
    [ngClass]="{ 'bg-surface-container-high shadow-level-1': container.scrollTop > 24 }"
  >
    <div class="w-10"></div>
    <span>{{ user()?.username }}</span>
    <button matIconButton>
      <mat-icon>close</mat-icon>
    </button>
  </div>
  <div class="mz-user-panel-profile-container" #container (scroll)="(null)">
    <div class="mt-4 flex justify-center">
      <msk-avatar [name]="user()?.name ?? ''" [imageUrl]="user()?.avatar" size="big"></msk-avatar>
    </div>
    <div class="my-2">
      <span class="text-title-medium">{{ user()?.name }}</span>
    </div>
    <div class="pt-2 pb-6" *transloco="let t">
      <button matButton="outlined">
        <span>{{ t('layout.settings') }}</span>
      </button>
    </div>
    <div class="mz-user-panel-profile-list" *transloco="let t">
      <div class="mz-user-panel-profile-item" aria-hidden="true" (click)="$event.stopPropagation(); toggleMoreStores()">
        <span class="font-medium">
          {{ showMoreStores() ? t('layout.hide-more-stores') : t('layout.show-more-stores') }}
        </span>
        <div class="flex items-center gap-1">
          <div class="flex flex-row-reverse items-center gap-1" [class.hidden]="showMoreStores()">
            @for (store of stores().slice(0, 3); track store.id) {
              <msk-avatar [name]="store.name" size="small"></msk-avatar>
            }
            @if (stores().length > 3) {
              <msk-avatar [name]="'+'" size="small"></msk-avatar>
            }
          </div>
          <div
            class="bg-surface-container-low size-6 rounded-full transition-transform duration-300"
            [class.rotate-180]="showMoreStores()"
          >
            <mat-icon class="text-on-surface-variant">keyboard_arrow_down</mat-icon>
          </div>
        </div>
      </div>
      @if (showMoreStores()) {
        <div class="w-full overflow-hidden" animate.enter="msk-expanded" animate.leave="msk-collapsed">
          @for (store of stores(); track store.id) {
            <div class="mz-user-panel-profile-item" (click)="selectActiveStore(store)" aria-hidden="true">
              <div>
                <msk-avatar [name]="store.name" size="small"></msk-avatar>
                <span class="ms-3 font-medium">{{ store.name }}</span>
              </div>
              @if (currentStore() === store) {
                <div class="msk-chips">{{ t('active') }}</div>
              }
            </div>
          }
        </div>
      }
    </div>
    <div class="mz-user-panel-profile-list" *transloco="let t">
      <div class="mz-user-panel-profile-item" (click)="openLayoutSchemeDialog()" aria-hidden="true">
        <div>
          <mat-icon class="mat-icon-rtl-mirror">dark_mode</mat-icon>
          <span class="ms-3 font-medium">{{ t('layout.themes') }}</span>
        </div>
        @switch (layoutScheme()) {
          @case ('auto') {
            <span class="text-label-medium font-light">{{ t('layout.default') }}</span>
          }
          @case ('dark') {
            <span class="text-label-medium font-light">{{ t('layout.dark') }}</span>
          }
          @case ('light') {
            <span class="text-label-medium font-light">{{ t('layout.light') }}</span>
          }
        }
      </div>
      <div class="mz-user-panel-profile-item" (click)="openLayoutLanguageDialog()" aria-hidden="true">
        <div>
          <mat-icon class="mat-icon-rtl-mirror">language</mat-icon>
          <span class="ms-3 font-medium">{{ t('layout.languages') }}</span>
        </div>
        <span class="text-label-medium font-light">{{ t(activeLangLabel()) }}</span>
      </div>
      <div class="mz-user-panel-profile-item" (click)="openLayoutCurrencyDialog()" aria-hidden="true">
        <div>
          <mat-icon class="mat-icon-rtl-mirror">universal_currency_alt</mat-icon>
          <span class="ms-3 font-medium">{{ t('layout.currency') }}</span>
        </div>
        <span class="text-label-medium font-light">{{ t(activeCurrencyLabel()) }}</span>
      </div>
    </div>
    <div class="mz-user-panel-profile-list" *transloco="let t">
      <div class="mz-user-panel-profile-item" (click)="signOut()" aria-hidden="true">
        <div>
          <mat-icon class="mat-icon-rtl-mirror">logout</mat-icon>
          <span class="ms-3 font-medium">{{ t('layout.sign-out') }}</span>
        </div>
      </div>
    </div>
  </div>
</mat-menu>
