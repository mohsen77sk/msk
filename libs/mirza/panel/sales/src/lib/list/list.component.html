<div class="page-layout grid-scroll">
  <!-- Header -->
  <div class="header" [formGroup]="filterForm" *transloco="let t">
    <div class="search-container">
      <div class="msk-mat-search-bar">
        <mat-icon>search</mat-icon>
        <input [formControl]="search" autocomplete="off" [placeholder]="t('sales.search')" />
      </div>
      <msk-sort-menu [sortData]="sortData" [sortItems]="sortItems" />
    </div>
    <div class="filter-container">
      <msk-filter-date [label]="t('sales.details.date')" formControlName="dateRange"></msk-filter-date>
      <msk-filter-menu
        [label]="t('sales.details.customer')"
        formControlName="customerId"
        [datasource]="customerLookupDS"
      ></msk-filter-menu>
      <msk-filter-menu
        [label]="t('sales.details.product')"
        formControlName="productId"
        [datasource]="productLookupDS"
      ></msk-filter-menu>
      <msk-filter-menu
        [label]="t('sales.details.paymentType')"
        formControlName="paymentType"
        [datasource]="paymentTypeLookupDS"
      ></msk-filter-menu>
    </div>
  </div>

  <!-- Main -->
  <div class="content">
    <!-- Summery -->
    @if (dataSource.length > 0) {
      <div class="flex snap-x items-center gap-4 overflow-x-auto border-b p-4" *transloco="let t">
        <div class="msk-mat-card-filled min-w-24 shrink-0 snap-center px-4 py-3">
          <div class="text-on-surface-variant text-label-medium mb-2">{{ t('sum') }}</div>
          <div class="text-label-large">
            {{ dataSummery()?.totalSum ?? 0 | mskCurrency }}
          </div>
        </div>
        @for (item of dataSummery()?.paymentTypes; track item.paymentType) {
          <div class="msk-mat-card-filled min-w-24 shrink-0 snap-center px-4 py-3">
            <div class="text-on-surface-variant text-label-medium mb-2">
              {{ t('paymentTypes.' + item.paymentType) }}
            </div>
            <div class="text-label-large">{{ item.value | mskCurrency }}</div>
          </div>
        }
      </div>
    }

    <!-- List -->
    <cdk-virtual-scroll-viewport class="content-grid" #gridContent [itemSize]="72">
      <!-- Rows -->
      <div
        class="content-grid-item tow-line"
        [class.pointer-events-none]="!invoice"
        *cdkVirtualFor="let invoice of dataSource; trackBy: trackById"
        [routerLink]="['card', 'view', invoice?.id]"
        matRipple
      >
        @if (invoice) {
          <!-- Content -->
          <div class="content-grid-item-content">
            <div class="truncate">{{ invoice.title }}</div>
            <div class="truncate">
              <span *transloco="let t; prefix: 'paymentTypes'">
                @for (i of invoice.paymentTypes; track i.paymentType; let last = $last) {
                  {{ t(i.paymentType) }}
                  @if (!last) {
                    -
                  }
                }
              </span>
              <span>{{ invoice.total | mskCurrency }}</span>
            </div>
          </div>
          <!-- End -->
          <div class="content-grid-item-end">
            <div class="truncate">{{ invoice.saleDate | mskDateTime: 'relative' }}</div>
          </div>
        } @else {
          <div class="content-grid-item-content">
            <div class="skeleton skeleton-text skeleton-text-lg"></div>
            <div class="skeleton skeleton-text skeleton-text-sm"></div>
          </div>
        }
      </div>
    </cdk-virtual-scroll-viewport>

    <!-- Empty state -->
    @if (dataSource.length === 0) {
      <msk-empty-state class="inset-0 h-full w-full"></msk-empty-state>
    }

    <!-- Fab -->
    <div class="content-fab-container">
      <button matFab extended [routerLink]="['card', 'new']" [mskFabExtendedCollapse]="gridContent" @zoomIn>
        <mat-icon>add</mat-icon>
        <span *transloco="let t">{{ t('new') }}</span>
      </button>
    </div>
  </div>
</div>

<!-- Invisible router-outlet for card component -->
<div class="pointer-events-none invisible absolute h-0 w-0 opacity-0">
  <router-outlet></router-outlet>
</div>
