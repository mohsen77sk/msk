<div class="flex gap-0.5">
  <button
    [matButton]="!value() ? 'outlined' : ''"
    class="rounded-small text-default h-8 ps-4 pe-2"
    [class.rounded-e-none]="value()"
    [class.bg-secondary-container]="value()"
    [class.text-on-secondary-container]="value()"
    [matMenuTriggerFor]="menu"
    [disabled]="isDisabled()"
  >
    <span class="flex items-center gap-1">
      {{ displayLabel() }}
      <mat-icon>arrow_drop_down</mat-icon>
    </span>
  </button>
  @if (value()) {
    <button
      matIconButton
      class="bg-secondary-container text-on-secondary-container rounded-e-small relative h-8 w-8 overflow-hidden rounded-none"
      [style.--mat-icon-button-container-shape.px]="0"
      (click)="$event.stopPropagation(); updateValue(undefined)"
    >
      <mat-icon class="font-light">close_small</mat-icon>
    </button>
  }

  <mat-form-field style="display: none">
    <mat-date-range-input [rangePicker]="picker">
      <input matStartDate [value]="customStartDate()" (dateChange)="customStartDate.set($event.value)" />
      <input matEndDate [value]="customEndDate()" (dateChange)="customEndDate.set($event.value)" />
    </mat-date-range-input>
    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
    <mat-date-range-picker #picker touchUi (closed)="updateValue('custom')"></mat-date-range-picker>
  </mat-form-field>
</div>

<mat-menu #menu="matMenu" cl>
  @for (item of datasource; track item.id) {
    <button
      mat-menu-item
      [class.bg-primary-container]="value()?.key === item.id"
      [class.text-on-primary-container]="value()?.key === item.id"
      (click)="updateValue(item.id)"
    >
      <mat-icon>{{ value()?.key === item.id ? 'check' : '' }}</mat-icon>
      <span>{{ item?.name | transloco }}</span>
    </button>
  }
  <button mat-menu-item (click)="openCustomDatePicker(picker)">
    <mat-icon></mat-icon>
    <span class="flex min-w-40 items-center gap-8">
      {{ 'filter-date.custom' | transloco }}
      <mat-icon class="mat-icon-rtl-mirror">chevron_right</mat-icon>
    </span>
  </button>
</mat-menu>
